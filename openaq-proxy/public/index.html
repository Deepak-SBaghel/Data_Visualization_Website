<!DOCTYPE html>
<html>
<head>
  <title>Air Quality Comparison</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart', 'bar']});
    google.charts.setOnLoadCallback(drawChart);

    async function fetchData() {
      const url = 'http://localhost:3000/api/measurements?countries=IN,US,GB'; // Example countries
      const response = await fetch(url);
      const data = await response.json();
      return data;
    }

    function aggregateDataByCountry(data) {
      return data.map(({ country, data: measurements }) => {
        const averagePM25 = measurements.reduce((acc, item) => acc + item.value, 0) / measurements.length;
        return [country, averagePM25];
      });
    }

    async function drawChart() {
      const data = await fetchData();
      const aggregatedData = aggregateDataByCountry(data);

      const formattedData = [['Country', 'Average PM2.5']].concat(aggregatedData);

      const dataTable = google.visualization.arrayToDataTable(formattedData);

      const options = {
        title: 'Average PM2.5 Concentration by Country',
        chartArea: {width: '50%'},
        hAxis: {
          title: 'PM2.5 Concentration (µg/m³)',
          minValue: 0
        },
        vAxis: {
          title: 'Country'
        }
      };

      const chart = new google.visualization.BarChart(document.getElementById('chart_div'));
      chart.draw(dataTable, options);
    }
  </script>
</head>
<body>
  <div id="chart_div" style="width: 100%; height: 500px;"></div>
</body>
</html>
